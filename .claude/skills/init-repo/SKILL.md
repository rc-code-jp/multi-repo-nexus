---
name: init-repo
description: 複数のリポジトリを持つプロジェクトの親リポジトリをAIで初期化するスキル
---
# Init Repo スキル

このスキルは、複数のリポジトリ（マルチリポジトリ）を持つプロジェクトの親となるリポジトリを初期化します。
AIのルールなどを親ディレクトリで一括管理し、環境構築や横断したタスクをこなせる中心的な構成を提供します。

## When to Use

- 新しいマルチリポジトリプロジェクトをセットアップするとき
- 既存のプロジェクトを親リポジトリで管理する構成に変更するとき
- git_info_excludeを使用して下層のリポジトリをGit管理から除外しつつ、AIからは読み取り可能にしたいとき
- 複数のサブプロジェクトを統括する親プロジェクトの環境を構築するとき

## Instructions

### 0. 初期化完了状態のチェック（必須）

**最初に必ず以下を実行する：**

`view_file` ツールまたはファイルシステムチェックで `.claude/skills/init-repo/.completed` ファイルの存在を確認する。

- **ファイルが存在する場合：** 
  - ユーザーに「✅ このリポジトリは既に初期化済みです。`.completed` ファイルが存在します。」と伝える
  - このスキルの実行を終了し、以降のステップは実行しない
- **ファイルが存在しない場合：** 
  - 以下のステップ1から順に実行する

### 1. リポジトリの状態確認

- 現在のディレクトリが Git リポジトリであることを確認する
- `.git` ディレクトリの存在を確認する
- 既存のプロジェクトフォルダやサブリポジトリの有無を確認する

### 2. .git_info_exclude ファイルの確認・作成

`view_file` ツールで `.git_info_exclude` ファイルの存在を確認する。

- **ファイルが既に存在する場合：**
  - 内容を確認し、ユーザーに現在の設定を伝える
  - 必要に応じて、追加のサブプロジェクトがあるか確認する
  
- **ファイルが存在しない場合：**
  - ユーザーに既存のサブプロジェクトがあるか確認する
  - サブプロジェクトがある場合は、そのディレクトリ名をリスト化する
  - `write_to_file` ツールで以下のフォーマットでファイルを作成する：

**推奨フォーマット例：**
```
# ここには子リポジトリのディレクトリ名を記載してください。
/project-a
/project-b
```

**パターンの説明：**
- `/project-a` のように先頭に `/` を付けるとルート直下のディレクトリのみにマッチ
- `/*` は不要（ディレクトリ全体を除外する場合）

### 3. .git/info/exclude への設定反映

まず、`view_file` ツールまたは `ls` コマンドで `.git/info/exclude` ファイルの存在を確認する。

- **ファイルが存在しない場合：**
  - `run_command` ツールで以下のコマンドを実行してファイルを作成する：
  ```zsh
  touch .git/info/exclude
  ```

次に、`.git_info_exclude` の内容を `.git/info/exclude` に追加する。
`run_command` ツールで以下のコマンドを実行して、重複を避けつつ追加する：

```zsh
grep -Fxv -f .git/info/exclude .git_info_exclude >> .git/info/exclude
```

**このコマンドの動作：**
- `.git_info_exclude` の内容のうち、`.git/info/exclude` に既に存在しない行のみを追加する
- 重複を防ぎ、冪等性を確保する

### 4. 環境変数ファイルの設定

`view_file` ツールまたは `ls` コマンドで `.env.example` ファイルの存在を確認する。

- **`.env.example` が存在する場合：**
  - `run_command` ツールで以下のコマンドを実行し、`.env` ファイルを作成する：
  ```zsh
  cp .env.example .env
  ```
  - ユーザーに `.env` ファイルの編集が必要かどうかを確認し、必要に応じて編集を促す
  
- **`.env.example` が存在しない場合：**
  - ユーザーに「`.env.example` ファイルが存在しないため、このステップをスキップします」と伝える
  - 次のステップに進む

### 5. サブプロジェクトのクローン

`.git_info_exclude` ファイルに記載されたサブプロジェクトを `git clone` する。

まず、ユーザーに各サブプロジェクトのGitリポジトリURLを確認する。
URLが提供された場合、以下のシェルスクリプトを `run_command` ツールで実行する：

**実行前の準備：**
1. ユーザーに「サブプロジェクトのGitリポジトリURLを教えてください」と尋ねる
2. URLのリストを取得する（例: `project-a` → `https://github.com/user/project-a.git`）

**シェルスクリプト例：**
```zsh
# .git_info_exclude からプロジェクト名を抽出してクローン
while IFS= read -r line; do
  # コメント行と空行をスキップ
  [[ "$line" =~ ^#.*$ || -z "$line" ]] && continue
  
  # スラッシュを削除してプロジェクト名を取得
  project_name="${line#/}"
  
  # プロジェクトディレクトリが既に存在する場合はスキップ
  if [ -d "$project_name" ]; then
    echo "⏭️  $project_name は既に存在します。スキップします。"
    continue
  fi
  
  # ユーザーから提供されたURLでクローン（URLは事前に確認済み）
  # 例: git clone https://github.com/user/$project_name.git $project_name
  echo "📦 $project_name をクローンする準備ができました"
done < .git_info_exclude
```

**注意事項：**
- URLが提供されない場合、このステップをスキップする
- 既にディレクトリが存在する場合はクローンをスキップする
- プライベートリポジトリの場合、認証が必要になることをユーザーに伝える

### 6. Git 状態の確認

`run_command` ツールで `git status` を実行し、サブプロジェクトがGit管理から除外されていることを確認する。
除外が正しく機能していれば、`.git_info_exclude` に記載したディレクトリが untracked files に表示されないはず。

### 7. IDE/エディタの再起動を促す

⚠️ **重要な注意事項：**
`.git/info/exclude` の変更を反映するため、IDEやVSCodeを再起動する必要があることをユーザーに伝える。
再起動しないとGit監視が更新されない可能性がある。

### 8. 初期化の完了確認

以下の各項目について、ファイルの存在やコマンド実行結果を確認し、全て完了していることを検証する：

1. **`.git_info_exclude` ファイルの確認**
   - `view_file` で内容を確認し、除外するプロジェクトが記載されている
   
2. **`.git/info/exclude` への反映確認**
   - `view_file` で `.git/info/exclude` の内容を確認し、`.git_info_exclude` の内容が追加されている
   
3. **`.env` ファイルの存在確認（`.env.example` があった場合）**
   - `view_file` または `ls` コマンドでファイルが存在することを確認
   
4. **サブプロジェクトのクローン確認（URLが提供された場合）**
   - `ls` コマンドでサブプロジェクトのディレクトリが存在することを確認

5. **Git 除外の動作確認**
   - `git status` コマンドを実行し、サブプロジェクトが untracked files に表示されないことを確認
   
6. **ユーザーへの案内完了**
   - IDE/エディタの再起動について、ユーザーに伝えたことを確認

### 9. 次のステップの案内

ユーザーに以下の次のステップを案内する：

1. サブプロジェクトを追加する場合は、`.git_info_exclude` にディレクトリ名を追加する
2. IDE/エディタを再起動する
3. AIから全てのサブプロジェクトが読み取り可能であることを確認する

### 10. 完了マーカーファイルの作成

全ての初期化ステップ（ステップ1〜9）が正常に完了したことを確認したら、以下のコマンドを `run_command` ツールで実行し、`.completed` ファイルを作成する：

```zsh
touch .claude/skills/init-repo/.completed
```

**このファイルの役割：**
- 初期化が完了したことを示すマーカーファイル
- 次回このスキルが実行された際、ステップ0で初期化済みであることを検出できる
- `.gitignore` で Git 管理から除外されているため、ローカル環境のみで管理される

## Additional Notes

- このボイラーテンプレートは、Antigravity、Claude Code、OpenCode などの AI コーディングツールとの統合を想定している
- `git_info_exclude` を使用することで、サブプロジェクトをGit管理から除外しつつ、AIエージェントからは読み取り可能にすることができる
- マルチリポジトリ構成により、各サブプロジェクトは独立したGitリポジトリとして管理できる
- 親リポジトリで共通のルールや設定を一括管理できるため、プロジェクト全体の一貫性を保ちやすい

## Troubleshooting

### `.git/info/exclude` が存在しない

以下のコマンドで手動作成する：
```zsh
touch .git/info/exclude
```

### Git除外が反映されない

1. IDEやエディタを再起動する
2. `git status` で確認する
3. `.git/info/exclude` の内容を直接確認し、パターンが正しいか検証する

### サブプロジェクトがAIから読み取れない

- `.git/info/exclude` は Git の管理対象から除外するだけで、ファイルシステムからは削除されない
- AIツールがワークスペース全体を読み取れるように設定されているか確認する
- サブプロジェクトのディレクトリが実際に存在するか確認する
